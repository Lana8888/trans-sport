# Анализ рисков и компромиссов архитектуры
## Риски
### 1. Использование облачных решений
Использование облачных решений в качестве инфраструктурной и программной платформы (SaaS + Paas, см. [Инфраструктура](https://github.com/Lana8888/trans-sport/blob/main/14.4-infrastructure-view.md)).

#### <i>1.1. Факторы принятия решения</i>
Распределённая архитектура системы с большим охватом стран и регионов не предполагает жёсткой централизации. 
Скорость захвата рынка диктует выбор самого быстро реализуемого инфраструктурного решения. Облачные сервисы и компоненты в этом случае быстрее "поднять" и настроить, чем закупить физическое железо, организовать серверные помещения и нанять персонал для обслуживания hardware.

#### <i>1.2. Преимущества</i>
1. Быстрота разворачивания и настройки.
2. Минимизация персонала.
3. Возможность реализации гибкой страновой/региональной политики размещения основных узлов системы. Возможность использования облачных вендоров непосредственно в странах/регионах присутствия.
4. Минимизация платы за ресурсы (платим столько, сколько используем).
5. Высокая скорость и низкая стоимость масштабирования инфраструктуры.
6. Независимость от одной-двух компаний-поставщиков физического оборудования и ПО.

#### <i>1.3. Недостатки</i>
1. Зависимость от поставщиков облачных ресурсов.
2. Риски хищения, слива данных из облака по вине поставщиков или при наличии незакрытых уязвимостей.
3. Сложности интеграции между разными облачными платформами.

### 2. Использование Брокера сообщений (Message Broker, MB)
#### <i>2.1. Факторы принятия решения</i>
Для информационного обмена между сервисами необходим универсальный интеграционный механизм, обеспечивающий единообразное подключение сервисов и возможности сохранения интеграции при отказе отдельных экземпляров сервиса (очеред сообщений сохраняется и может быть вычитана другим поднятым экземпляром).
Обоснование использования MB приведено в [ADR Реализация внутренних интеграций (между разрабатываемыми сервисами)](https://github.com/Lana8888/trans-sport/blob/main/11.02-ADR-internal-integration.md).

#### <i>2.2. Преимущества</i>
1. Отказоустойчивость, возможность резервирования очередей сообщений.
2. Доступные механизмы подключения к MB для большинства сервисов.
3. Высокая производительность (за счёт очереди не забивается канал обращения к самому сервису).
4. Универсальность.

#### <i>2.3. Недостатки</i>
1. Централизованные MB - типовая точка критического отказа. Если "упадёт" брокер, упадёт вся система (решение - MB failover).
2. "Узкое горло", влияющее на latency отклика сервисов (MB - менее быстродейственен, чем, например, API).
3. Необходимость синхронизации между узлами/плечами MB (решение - синхронизация в самое малонагруженное время).

## Компромиссы
### 1. Использование совместно облачных ресурсов на базе SaaS + PaaS
См. [Инфраструктура](https://github.com/Lana8888/trans-sport/blob/main/14.4-infrastructure-view.md)
#### <i>1.1. Факторы принятия решения</i>
Ввиду географической распределённости системы и планируемого широкого охвата пользователей (транснациональная компания) необходимо реализовать решение, которое:

а) наиболее быстро разворачивается;

б) требует наименьшей номенклатуры и численности персонала для настройки и обслуживания инфраструктуры и приложений.

То есть для того, чтобы развернуться в новом регионе, не нужно создавать огромную команду, которая будет заниматься подбором железа, его настройкой, установкой и обновлениями служебного ПО (такого как СУБД, Службы Мониторинга, Логирования, Аудита ИБ, Брокеры сообщений, Балансировщики). 

Другими словами, всё, что не является уникальным для нашей системы - должно быть делегировано другим уже готовым сервисам и системам.

Поэтому не рассматривался вариант IaaS - как требующий низкоуровневой настройки ИТ-ресурсов.

Также использование одного лишь PaaS - не подходит, т.к. в этом случае придётся силами специалистов компании устанавливать и настраивать общеприменимое типовое ПО, от которого, по сути, не требуется в данной системе никаких уникальных функций (то есть могут быть использованы готовые сервисы).

В то же время полностью отказаться от PaaS - не получится, т.к. нужны платформа и базовая ОС, для того, чтобы заниматься разработкой приложений, а также для работы прикладных сервисов, не подпадающих под типовые рыночные решения. 

Использование SaaS - обусловлено тем, что нужно минимизировать затраты на разворачивание и обслуживание типовых приложений (таких как СУБД, Службы Мониторинга, Логирования, Аудита ИБ, Брокеры сообщений, Балансировщики).

Таким образом, компромиссный вариант включает в себя платформенную и прикладную части, реализуемые на базе облачных технологий PaaS + SaaS.

#### <i>1.2. Преимущества</i>
1. Минимизация затрат на обслуживание типового ПО.
2. Достаточная степень свободы для разработки своих уникальных сервисов и приложений.
3. Быстрая разворачиваемость и масштабируемость на регионы/ страны.
4. Отсутствие привязки к конкретному поставщику/ технологии (в разных локациях может быть выбран свой набор ПО + Платформы, удобный для нативной команды и характерный для данного региона).

#### <i>1.3. Недостатки</i>
1. Сложности интеграции между разными платформами и прикладными системами (необходимо искать баланс).
2. Зависимость настроек для типового ПО от вендоров SaaS (выбирать ПО с достаточным запасом гибкости).

### 2. Разработка собственного сервиса управления клиентскими данными
См. [ADR Реализация сервиса Clients Service](https://github.com/Lana8888/trans-sport/blob/main/11.03-ADR-clients-service.md)
#### <i>2.1. Факторы принятия решения</i>
В существующей системе наверняка уже имеются сервисы, обеспечивающие работу с клиентскими данными и запросами. Наша команда не обязательно сможет получить доступ на изменение существующих клиентских сервисов. С другой стороны копаться в чужом коде и пытаться вписать доработки в существующие сервисы - не гарантирует результат, а кроме того, может привести к увеличению сроков и стоимости разработки, и даже сделать невозможным разработку и внедрение необходимых нам функций. 

Поэтому было выбрано решение - разработать собственный Clients Service - "прослойку". Который, с одной стороны сможет брать данные из существующих клиентских сервисов. А с другой стороны - позволит реализовать все необходимые функции для работы с клиентами в собственном сервисе, не завися от сторонних приложений и сервисов.
#### <i>2.2. Преимущества</i>
1. Возможность реализации всех необходимых новых фичей с сохранением уже существующей функциональности.
2. Возможность переиспользования уже существующих клиентских данных.
3. Полный контроль разработки сервиса-прослойки, своя релизная политика, соблюдение КТ и сроков проекта.
4. Возможность использования требуемых именно для нашей системы механизмов интеграции.

#### <i>2.3. Недостатки</i>
1. Затраты на интеграцию с существующим Clients Service.
2. Возможное дублирование данных.
3. Время на синхронизацию клиентских данных между одноимёнными сервисами.
