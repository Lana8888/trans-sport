# Информационное представление
## 1. DB Geo
<b>DB Geo</b> - БД Geo Service, которая хранит информацию о гео-позиции клиента, тренировочных спотах и местах проведения соревнований.

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_geo.png)

Состоит из таблиц geo_spot и geo_client.

1.1. Таблица geo_spot - содержит гео-объекты: площадки для тренировок, стадион, спот, начало трека и т.п.
Содержит атрибуты:
* ID_geo - int64 - общий идентификатор гео-объекта (область, точка); NOT NULL
* ID_spot - int64 - идентификатор спота; может быть NULL
* g_datetime - timestamp - дата/время создания записи; NOT NULL
* g_location_obj - geography (Object) - гео-объект (область, регион, полигон); может быть NULL
* g_location_pnt - geography (Point) - гео-точка (координаты); может быть NULL
* g_description - string - описание гео-объекта; может быть NULL

1.2. Таблица geo_client - гео-позиция клиента. Таблица чистится по мере устаревания информации (например, раз в час или чаще, в зависимости от частоты запросов и имеющегося места для хранения информации).
Содержит атрибуты:
* ID_geo - int64 - идентификатор записи; NOT NULL
* ID_client - int64 - идентификатор клиента; NOT NULL
* g_datetime - timestamp - дата/время создания записи; NOT NULL
* g_location - geography (Point) - гео-позиция клиента в момент выполнения запроса на определение; NOT NULL

## 2. DB Social
<b>DB Social</b> - БД Social Service, хранит информацию о социальных группах, клиентах, входящих в группу, привязке социальных групп к спотам и местам проведения соревнований.

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_social.png)

Состоит из таблицы soc_groups.

2.1. Таблица soc_groups содержит атрибуты:
* ID_group - int64 - идентификатор записи; NOT NULL
* soc_datetime - timestamp - дата/время создания записи; NOT NULL
* soc_grpname - string - наименование соц. группы; NOT NULL
* soc_description - string - описание группы; может быть NULL
* soc_grptype - string, enum - тип соц. группы (для соревнований, для общения по виду спорта, группа пользователей спота и т.п.); NOT NULL
* soc_client_ID - [int64] - массив идентификаторов клиентов, входящих в группу; NOT NULL
* soc_spot_ID - [int64] - массив идентификаторов спотов, привязанных к группе; может быть NULL

## 3. DB Training
3a. <b>DB Training</b> - БД Training Service, хранит информацию о тренировочных планах и рекомендациях тренировок для клиента.

3b. <b>Cashe Training</b> - кэш БД для хранения актуальной информации, к которой нужен быстрый доступ. Например, тренировочные планы в стадии выполнения или информация за последнюю неделю/ месяц / квартал (необходимо установить глубину хранения в процессе тестовой эксплуатации).

Выполненные планы или планы, созданные давно, отправляются в архив и удаляются после истечения срока хранения (срок определяется в ТЗ).

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_training.png)

Состоит из таблицы train_plan.

3.1. Таблица train_plan содержит атрибуты:
* ID_train - int64 - идентификатор записи; NOT NULL
* train_datetime - timestamp - дата/время создания записи; NOT NULL
* train_description - string - описание тренировочного плана/рекомендации; NOT NULL
* train_plan - string (YAML) - состав тренировочного плана/рекомендации (может содержать в установленном формате структуры виды упражнений, количество подходов/повторений, длительность упражнения, общие рекомендации по режиму тренировки и т.п.; NOT NULL
* train_startplan - date - дата начала тренировочного плана; может быть NULL
* train_endplan - date - дата окончания тренировочного плана; может быть NULL
* train_client_ID - int64 - идентификатор клиента, к которому относится данный план/рекомендация; NOT NULL

## 4. DB Statistics 
4a. <b>DB Statistics</b> - БД Statistics Service, хранит информацию о статистике тренировок, метриках пользователя, победах, наградах, достижении тренировочных целей.

4b. <b>Cache Statistics</b> - кэш БД Statistics, используется для оперативного доступа к тренировочной статистике. Например, статистика за последнюю неделю/ месяц / квартал (необходимо установить глубину хранения в процессе тестовой эксплуатации).

Статистика имеет историческую глубину хранения, устанавливаемую в ТЗ. Неактуальная и устаревшая статистика архивируется, затем удаляется.

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_statistics.png)

Состоит из таблиц stat_train, stat_competitions, stat_metrics, stat_goals.

4.1. Таблица stat_train предназначена для хранения статистики тренировок. Содержит атрибуты:
* ID_stat_train - int64 - идентификатор записи; NOT NULL
* stat_train_datetime - timestamp - дата/время создания записи; NOT NULL
* stat_train_description - string - описание статистического показателя; NOT NULL
* stat_train_exercises - string (YAML) - описание упражнений, выполненных в ходе сбора данного статистического показателя, или пройденных дистанций/этапов; может быть NULL
* stat_train_start - datetime - дата/время начала тренировки; NOT NULL
* stat_train_end - datetime - дата/время окончания тренировки; может быть NULL
* stat_train_client_ID - int64 - идентификатор клиента, к которому относится статистический показатель; NOT NULL

4.2. Таблица stat_competitions предназначена для хранения статистики соревнований. Содержит атрибуты:
* ID_stat_compet - int64 - идентификатор записи; NOT NULL
* stat_compet_datetime - timestamp - дата/время создания записи; NOT NULL
* stat_compet_description - string - описание соревнования; NOT NULL
* stat_compet_results - string (YAML) - результаты по соревнованию в целом или по этапам соревнований в виде структурированного YAML; NOT NULL
* stat_compet_start - datetime - дата/время начала соревнования; NOT NULL
* stat_compet_end - datetime - дата/время окончания соревнования; может быть NULL
* stat_compet_client_ID - int64 - идентификатор клиента, к которому относится данная запись о результатах соревнования; NOT NULL
* stat_compet_spot_ID - int64 - идентификатор спота, на котором проводилось соревнование; может быть NULL

4.3. Таблица stat_metrics предназначена для хранения статистики метрик пользователя (вес, объёмы, иные физиологические показатели и т.п.). Содержит атрибуты:
* ID_stat_metr - int64 - идентификатор записи; NOT NULL
* stat_metr_datetime - timestamp - дата/время создания записи; NOT NULL
* stat_metr_params - string (YAML) - структура, содержащая метрики пользователя; NOT NULL
* stat_metr_client_ID - int64 - идентификатор клиента, к которому относятся данные метрики; NOT NULL

4.4. Таблица stat_goals предназначена для хранения статистики достижения целей пользователя. Содержит атрибуты:
* ID_stat_goal - int64 - идентификатор записи; NOT NULL
* stat_goal_datetime - timestamp - дата/время создания записи; NOT NULL
* stat_goal_params - string (YAML) - структура, содержащая перечень целей/достижений и параметры по ним; NOT NULL
* stat_goal_client_ID - int64 - идентификатор клиента, к которому относятся данные достижения; NOT NULL

## 5. DB Target 
<b>DB Target</b> - БД Target Service, хранит информацию о таргет-предложениях для конкретных пользователей, регионов, видов спорта, инвентаря, одежды. Хранит информацию за последнюю неделю/ месяц / квартал (необходимо установить глубину хранения в процессе тестовой эксплуатации).

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_target.png)

Состоит из таблицы target.

5.1. Таблица target содержит атрибуты:
* ID_target - int64 - идентификатор записи; NOT NULL
* tg_datetime - timestamp - дата/время создания записи; NOT NULL
* tg_description - string - описание таргет-предложения; NOT NULL
* tg_content - string (YAML) - содержимое таргет-предложения; NOT NULL
* tg_location - geography (Region) - регион, к которому относится таргет-предложение; может быть NULL
* tg_client_class - string - класс клиентов, к которым относится таргет-предложение; может быть NULL
* tg_start - datetime - дата/время начала действия таргет-предложения; NOT NULL
* tg_end - datetime - дата/время окончания действия таргет-предложения; может быть NULL
* tg_isactive - bool - является ли таргет-предложение активным; NOT NULL

## 6. DB Clients (interlayer) и Data Vault Clients 
6a. <b>DB Clients (interlayer)</b> - БД Clients Service (interlayer), хранит информацию о клиентах в рамках новых фичей, реализуемых системой. Информация о клиентах хранится в удобной для приложения форме. Также хранит оперативные витрины, собранные на основе данных из Data Vault Clients. Синхронизируется с существующей БД клиентов DB Clients (existing).

6b. <b>Data Vault Clients</b> - хранилище Data Vault, используемое для агрегации данных из различных БД клиентов, принадлежащих существующим сервисам Clients Service. В дальнейшем может использоваться для реализации связи между клиентом, его экипировкой, тренировками, статистикой, покупками и т.п.

![DB Geo](https://github.com/Lana8888/trans-sport/blob/main/informational-view_db_clients.png)

6.1. DB Clients (interlayer) cостоит из таблицы clients.

6.1.1. Таблица clients содержит атрибуты:
* ID_client - int64 - идентификатор записи (идентификатор клиента, который используется в БД смежных сервисов в качестве внешнего ключа); NOT NULL
* client_code - string - код клиента в системе приложения, может быть использована система кодификации (по стране, региону, видам спорта и т.п. - для быстроты классификации клиента по коду), или код может быть использован для других целей; NOT NULL
* client_name  - string - имя, фамилия клиента; NOT NULL
* client_address - string - адрес клиента; может быть NULL
* client_email - string - почта клиента; может быть NOT NULL
* client_phone - string - номер телефона клиента; NOT NULL
* client_geo_ID - int64 - идентификатор геопозиции клиента, базовая привязка по адресу проживания либо по преобладающему местонахождению, определённому с помощью Geo Service; может быть NULL

6.2. Data Vault Clients cостоит из таблиц hub_client и sat_client.

6.2.1. Таблица hub_client - хаб, отражающий основное представление сущности Клиент и содержит набор метаданных сущности:
* client_hash_key - binary - первичный ключ (MD5 или SHA-1 хеш от бизнес ключа); NOT NULL
* load_date - timestamp - дата/время загрузки записи; NOT NULL
* record_source - varchar - источник записи; NOT NULL
* client_ID - varchar - бизнес-ключ (идентификатор клиента в мастер-системе или уникальный естественный идентификатор клиента из мастер-системы, например, номер телефона, адрес почты, номер паспорта); NOT NULL

6.2.2. Таблица sat_client - сателлит, содержащий описательные атрибуты сущности Клиент:
* client_hash_key - binary - ; NOT NULL
* load_date - timestamp - ; NOT NULL
* record_source - varchar - ; NOT NULL
* client_name - string - ; NOT NULL
* client_data - string (YAML) - ; NOT NULL
* client_description - string (YAML) - ; NOT NULL
* created_at - timestamp - ; NOT NULL
* updated_at - timestamp - ; NOT NULL
