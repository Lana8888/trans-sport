# Реализация внешних интеграций (с существующими сервисами/ системами)

Данный ADR описывает архитектурные решения, принятые для реализации интеграций между сервисами разрабатываемой системы и внешними (уже существующими) сервисами и системами.

## Контекст и постановка проблемы

Необходимо определить способы интеграции между разрабатываемыми и существующими внешними сервисами согласно [Концептуальной архитектуре](https://github.com/Lana8888/trans-sport/blob/main/04%20-%20conceptual-architecture.md#%D0%BA%D0%BE%D0%BD%D1%86%D0%B5%D0%BF%D1%82%D1%83%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0).

Для первой очереди разработки выбираются сервисы, описанные в пп. 1-4 [Плана поэтапной разработки](https://github.com/Lana8888/trans-sport/blob/main/06-plan.md#%D0%BF%D0%BB%D0%B0%D0%BD-%D0%BF%D0%BE%D1%8D%D1%82%D0%B0%D0%BF%D0%BD%D0%BE%D0%B9-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B8-%D0%B8-%D1%80%D0%B0%D1%81%D1%88%D0%B8%D1%80%D0%B5%D0%BD%D0%B8%D1%8F-%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B-%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7-%D0%BA%D1%80%D0%B8%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8-%D0%B2%D0%B0%D0%B6%D0%BD%D1%8B%D1%85-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BE%D0%BD%D0%B5%D0%BD%D1%82%D0%BE%D0%B2).

Разрабатываемые сервисы: <b>Target Service</b>, <b>Geo Service</b>, <b>Social Service</b>, <b>Training Service</b>, <b>Statistics Service</b>.  

Существующие сервисы: <b>Buying Service</b>, <b>Sport Service</b>, <b>Clients Service</b> (требуется доработка), <b>Products Service</b>.  

Перечень интеграций:  

1. <b>Target Service - Buying Service</b>: интеграция таргета с сервисами/ приложениями для покупок (получение промоакций, скидок).
2. <b>Products Service - Target Service</b>: интеграция таргета с сервисом продуктов (получение информации о продуктах).
3. <b>Clients Service - Geo Service</b>: интеграция с клиентским сервисом (получение информации о клиентах, привязка клиента к гео-локации).
4. <b>Clients Service - Social Service</b>: интеграция с клиентским сервисом (получение информации о клиентах, передача информации о вхождении клиента в группы).
5. <b>Clients Service - Statistics Service</b>: интеграция с клиентским сервисом (получение информации о клиентах, передача информации о накопленных баллах и бонусах за тренировки и победу в соревнованиях).
6. <b>Sport Service - Training Service</b>: интеграция с сервисами/ приложениями для различных видов спорта (получение информации о составлении тренировок, особенностях разных видов спорта).

## Факторы принятия решения

* Интеграция с внешними сервисами должна быть максимально абстрагирована от реализации каждого из сервисов (особенно внешних, на разработку которых мы повлиять не можем).
* Должны быть использованы универсальные инструменты интеграции (которые большинство внешних сервисов сможет использовать либо в своём базовом исполнении, либо с минимальными доработками).
* Должна быть обеспечена стабильность интеграции, минимизированы риски отказов по интеграции (возможность резервирования передаваемых данных, повтора неудачных обращений, минимизация отказов в пиковые времена обращений к сервисам).

## Варианты

* в.1 - использование Брокера сообщений
* в.2 - API-интеграция
* в.3 - RPC-интеграция

### Преимущества и недостатки в.1 (использование Брокера сообщений)
<b>Преимущества</b>:  
* Отказоустойчивость, резервирование очередей сообщений  
* Доступные механизмы подключения к MB для большинства сервисов  
* Высокая производительность (за счёт очереди не забивается канал обращения к самому сервису)  
* Универсальность  

<b>Недостатки</b>:  
* Не самый быстродейственный способ  
* Затраты на ПО и инфраструктуру для MB, в т.ч. на построение отказоустойчивой схемы  
* Дополнительные затраты на сопровождение MB И его инфраструктуры  

### Преимущества и недостатки в.2 (API-интеграция)
<b>Преимущества</b>:  
* Быстродействие  
* Высокая степень информационной безопасности (можно открыть только нужные API)    

<b>Недостатки</b>:  
* Повышается нагрузка на сам сервис  
* Могут быть отказы сервиса в пиковые моменты 

## Выбранные варианты для каждой интеграции
Выбранные варианты интеграций между сервисами приведены на рисунке:
![hfasjl](https://github.com/Lana8888/trans-sport/blob/main/external-integration.png)
